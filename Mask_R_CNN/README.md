# Implement and Test a mask R_CNN model for Fluorescent image segmentation
## Overview:

This project implements and test a Mask R-CNN model using the fluorescent images and their corresponding labeled images. The gola is to train the model to detect and segment objects from the fluorescent microscopy data. The training data includes fluorescent images and labeled masks generated using MATLAB scipt in matlab_app. The testing data is also the fluorescent image and labeled mask generated by the matlab_app.

The python script is based on work in this article: https://www.analyticsvidhya.com/blog/2024/05/blood-cell-segmentation-with-mask-r-cnn/.
I modified the dataset class to fit the images generated by the MATLAB script, and the evaluate model part. 

Please open [Mask_RCNN_testing.ipynb](Mask_RCNN_testing.ipynb) to see the training process and result.

## Dataset Description

The dataset consists of two types of images:
1. Fluorescent images: These are uint16 256*256 PNG image generated by MATLAB, named as fluo_256_x.png where x is the image index
2. Labeled Masks: These are uint8 labeled images coresspond to the fluorescent images, named as label_fluo_256_x.png. The labeled masks provide pixel-wise segmentation to the objects in the images.

The images and masks are stored in the same folder.

## Model 
The project uses a pre-trained ResNET-50 backbone for the Mask R-CNN model.

## Training the Model

Due to the limitation of hardware, I only used 1 pair of fluorescent/labeled image and 5 epochs to train the model.

1. The fluorescent images and masks are loaded using a custom FluorescentDataset class. The class converts the image to a format compatible with Mask R-CNN (normalized, channel_adjusted)

2. The model is trained for 5 epochs using a standard training loop that calculates losses for classification, bounding boxes, and masks.

3. The loss value are printed for each epoch.

### Training output:
Epoch [1/5], Batch [1/1], Loss: 4.7811

Epoch [2/5], Batch [1/1], Loss: 1.0190

Epoch [3/5], Batch [1/1], Loss: 0.8867

Epoch [4/5], Batch [1/1], Loss: 0.8076

Epoch [5/5], Batch [1/1], Loss: 0.6245

## Evaluating the Model:

After training, I evaluate the model using images in the test_image. The images in the test_image are also generated by the MATLAB script.
We can visualize the model's prediction on the test images. It shows the bounding boxes and predicted masks.
I also calculated Intersection over Union (IoU) between the predicted masks and ground truth masks (labeled images).

The IoU for the boxes is 0.8576, and the Iou for the mask is: 0.6516.
These results suggested that the generated images can help to train the model.


